<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Grilla</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .descripcion-item {
      margin-right: 3%;
    }
  </style>
</head>
<body>
  <div id="form-container">
    <div id="header">
      <h1 style="color: #ccc;">Grilla de Ponderación de antecedentes</h1>
      <div id="aplicante-info" style="color: #ccc;">
        <p>Aplicante ID: 1</p>
        <p>Materia ID: 1</p>
      </div>
    </div>
    <div>
      <div id="total-general" class="floating">
        <h2>Total General</h2>
        <div id="total-general-value">0</div>
      </div>
    </div>
    <div id="formulario-container">
      <!-- Aquí se llenará con los datos obtenidos -->
    </div>
  </div>

  <script>
fetch('http://localhost:8080/api/v1/encabezado')
    .then(response => response.json())
    .then(data => {
      const formContainer = document.getElementById('formulario-container');
      const totalGeneralField = document.getElementById('total-general-value');

      if (data && Array.isArray(data.data)) {
        let totalGeneralSum = 0;

        data.data.forEach(encabezado => {
          const columna = document.createElement('div');
          columna.classList.add('column');

          const tituloEncabezado = document.createElement('h1');
          tituloEncabezado.textContent = `${encabezado.descripcion}`;
          columna.appendChild(tituloEncabezado);

          const itemsContainer = document.createElement('div'); // Contenedor para los items

          encabezado.item.forEach(item => {
            const campo = document.createElement('div');
            campo.classList.add('field');

            const label = document.createElement('label');
            label.setAttribute('class', 'descripcion-item');
            label.setAttribute('for', `item_${item.id}`);
            label.textContent = `${item.nombre}`; // Mostrar el nombre del ítem
            campo.appendChild(label);

            const input = document.createElement('input');
            input.setAttribute('class', 'entrada');
            input.setAttribute('type', 'number');
            input.setAttribute('id', `item_${item.id}`);
            input.setAttribute('name', `item_${item.id}`);
            input.setAttribute('min', '0');
            input.setAttribute('value', '0'); // Inicialmente establecido como 0

            campo.appendChild(input);
            columna.appendChild(campo);
          });

          formContainer.appendChild(columna);
        });
      } else {
        console.error('El formato de datos no es el esperado');
      }
    })
    .catch(error => {
      console.error('Hubo un error al obtener los datos:', error);
    });
    // Llamada a la API grillatabulacion
fetch('http://localhost:8080/api/v1/grillatabulacion/1/1/1')
  .then(response => response.json())
  .then(data => {
    if (data && Array.isArray(data.data)) {
      data.data.forEach(item => {
        const inputField = document.getElementById(`item_${item.item.id}`);
        if (inputField) {
          inputField.value = item.puntaje;
        }
      });
    } else {
      console.error('El formato de datos de grillatabulacion no es el esperado');
    }
  })
  .catch(error => {
    console.error('Hubo un error al obtener los datos de grillatabulacion:', error);
  });
  function initializeMultiplication() {
  const columnas = document.querySelectorAll('.column');

  columnas.forEach(columna => {
    const itemsContainer = columna.querySelector('.items-container');

    const inputs = itemsContainer.querySelectorAll('input[type="number"]');
    const resultadoFields = columna.querySelectorAll('.resultado-field');

    inputs.forEach(input => {
      input.addEventListener('input', () => {
        const encabezado = input.closest('.column');
        recalculateTotal(encabezado);
      });
    });

    function recalculateTotal(encabezado) {
      const inputs = encabezado.querySelectorAll('input[type="number"]');
      let sum = 0;

      inputs.forEach(input => {
        const value = parseFloat(input.value) || 0;
        const itemId = parseInt(input.getAttribute('id').split('_')[1]);
        const item = encabezado.item.find(item => item.id === itemId);
        const multiplicacion = value * parseFloat(item.valor) || 0;
        sum += multiplicacion;
      });

      const totalEncabezado = encabezado.querySelector('.total-encabezado');
      totalEncabezado.textContent = Math.min(sum, encabezado.maximo).toFixed(2);
      recalculateGeneralTotal();
    }

    function recalculateGeneralTotal() {
      const generalTotalFields = document.querySelectorAll('.total-encabezado');
      let totalGeneralSum = 0;

      generalTotalFields.forEach(field => {
        totalGeneralSum += parseFloat(field.textContent) || 0;
      });

      const totalGeneral = document.getElementById('total-general-value');
      totalGeneral.textContent = totalGeneralSum.toFixed(2);
    }

    recalculateTotal(columna);
  });
}

// Llamada para inicializar la multiplicación al cargar el formulario
initializeMultiplication();

console.log('Data obtenida:', data); // Verificar si los datos de la API son correctos
console.log('Item a establecer:', item); // Verificar los datos de cada item obtenido
console.log('Campo de entrada:', inputField); // Verificar si se encuentra el campo de entrada
console.log('Valor a establecer:', item.puntaje); // Verificar el valor a establecer en el campo
  </script>
</body>
</html>
